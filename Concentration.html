<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŸç¥é¢¨å…ƒç´ ç¥çµŒè¡°å¼±ï¼ˆãƒ†ãƒ¼ãƒå¯¾å¿œAIï¼‰</title>
<style>
:root {
  --main: #3ee6c4;
  --bg1: #1b2b4a;
  --bg2: #0b1324;
  --card: #243b6b;
  --card-open: #fff6d0;
}

body {
  font-family: sans-serif;
  background: radial-gradient(circle at top, var(--bg1), var(--bg2));
  color: var(--main);
  text-align: center;
  margin:0; padding:10px;
}

.board {
  display: grid;
  grid-template-columns: repeat(4, 70px);
  gap: 10px;
  justify-content: center;
  margin: 20px 0;
}

.card {
  width: 70px;
  height: 100px;
  background: var(--card);
  border: 2px solid var(--main);
  border-radius: 12px;
  cursor: pointer;
  font-size: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.card.open {
  font-size: 30px;
  background: var(--card-open);
}

#titleFrame {
  padding: 8px 16px;
  border-radius: 12px;
  border: 2px solid var(--main);
  margin: 10px auto;
  display: inline-block;
}

#titleFrame.gold {
  border: 2px solid gold;
  box-shadow: 0 0 15px gold;
  background: linear-gradient(45deg, rgba(255,215,0,0.15), rgba(255,255,255,0.05));
}

#titleFrame.developer {
  border: 3px solid gold;
  background: linear-gradient(135deg, rgba(255,215,0,0.35), rgba(255,255,255,0.1));
  box-shadow: 0 0 20px gold, 0 0 40px rgba(255,215,0,0.6);
  animation: devGlow 3s infinite alternate;
}

@keyframes devGlow {
  from { filter: brightness(1); }
  to   { filter: brightness(1.3); }
}

#achievementList li, #titleList li {
  list-style: none;
  padding: 6px;
  border-left: 3px solid var(--main);
  margin-bottom: 4px;
}
button { margin:5px; padding:6px 12px; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>
<h1>åŸç¥é¢¨å…ƒç´ ç¥çµŒè¡°å¼±ï¼ˆãƒ†ãƒ¼ãƒå¯¾å¿œAIï¼‰</h1>

<label for="element">å…ƒç´ ãƒ†ãƒ¼ãƒ:</label>
<select id="element" onchange="changeElement()">
  <option value="wind">ğŸŒª é¢¨</option>
  <option value="fire">ğŸ”¥ ç‚</option>
  <option value="water">ğŸ’§ æ°´</option>
  <option value="ice">â„ æ°·</option>
  <option value="thunder">âš¡ é›·</option>
  <option value="rock">ğŸª¨ å²©</option>
  <option value="grass">ğŸŒ¿ è‰</option>
</select>

<div>
<button id="startBtn" onclick="startGame()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<button id="stopBtn" onclick="stopGame()">â¹ ã‚¹ãƒˆãƒƒãƒ—</button>
<select id="aiDifficulty" onchange="changeAIDifficulty()">
  <option value="easy">AI: å¼±</option>
  <option value="medium">AI: ä¸­</option>
  <option value="hard">AI: å¼·</option>
</select>
</div>

<div id="board" class="board"></div>

<div id="status">
  <p>é€£å‹: <span id="streak">0</span></p>
  <p>å‹ç‡: <span id="winRate">0%</span></p>
</div>

<div id="titleFrame">
  <span id="equippedTitle">ãªã—</span>
</div>
<button onclick="equipCurrentTitle()">ğŸ– ã“ã®ç§°å·ã‚’è£…å‚™</button>

<h3>ğŸ“œ ç§°å·å›³é‘‘</h3>
<ul id="titleList"></ul>

<h3>ğŸ† å®Ÿç¸¾</h3>
<ul id="achievementList"></ul>

<div id="devPanel" style="display:none">
  <h3>ğŸ¨ Developer Mode</h3>
  <input type="color" id="uiColor" />
  <button onclick="applyUIColor()">é©ç”¨</button>
</div>

<script>
// ------------------------
// å…ƒç´ å®šç¾©
// ------------------------
const ELEMENTS = [
  { id: 'wind',    name: 'é¢¨', icon: 'ğŸŒª', color: '#3ee6c4' },
  { id: 'fire',    name: 'ç‚', icon: 'ğŸ”¥', color: '#ff4b4b' },
  { id: 'water',   name: 'æ°´', icon: 'ğŸ’§', color: '#3b82f6' },
  { id: 'ice',     name: 'æ°·', icon: 'â„', color: '#7dd3fc' },
  { id: 'thunder', name: 'é›·', icon: 'âš¡', color: '#a855f7' },
  { id: 'rock',    name: 'å²©', icon: 'ğŸª¨', color: '#facc15' },
  { id: 'grass',   name: 'è‰', icon: 'ğŸŒ¿', color: '#22c55e' }
];

// ------------------------
// ã‚²ãƒ¼ãƒ å¤‰æ•°
// ------------------------
let board=document.getElementById('board');
let opened=[];
let elementWins = JSON.parse(localStorage.getItem('elementWins'))||{};
let ownedTitles = JSON.parse(localStorage.getItem('titles'))||{};
let equippedTitle = localStorage.getItem('equippedTitle')||'';
let developerMode = localStorage.getItem('developerMode')==='true';
let streak=0, maxStreak=0;
let gameRunning=false;
let aiDifficulty='medium';
let aiTurn=false;
let aiMemory={};

// ------------------------
// ãƒ†ãƒ¼ãƒåˆ‡æ›¿
// ------------------------
function changeElement(){
  const elId=document.getElementById('element').value;
  document.body.dataset.element=elId;
  localStorage.setItem('element',elId);
  updateTitle();
  const element=ELEMENTS.find(e=>e.id===elId);
  if(element){
    document.documentElement.style.setProperty('--main', element.color);
    // é–‹ã„ã¦ã„ã‚‹ã‚«ãƒ¼ãƒ‰ã®æ è‰²ã‚‚æ›´æ–°
    document.querySelectorAll('.card.open').forEach(c=>{
      c.style.boxShadow=`0 0 20px ${element.color}`;
    });
  }
}
const savedElement = localStorage.getItem('element')||'wind';
document.body.dataset.element=savedElement;
document.getElementById('element').value=savedElement;
changeElement(); // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«åæ˜ 

// ------------------------
// ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
// ------------------------
function shuffleCards(){
  board.innerHTML='';
  aiMemory={};
  let cards=[...ELEMENTS,...ELEMENTS].sort(()=>Math.random()-0.5);
  cards.forEach((el,i)=>{
    const div=document.createElement('div');
    div.className='card';
    div.dataset.element=el.id;
    div.dataset.icon=el.icon;
    div.dataset.color=el.color;
    div.dataset.index=i;
    div.onclick=()=>playerMove(div);
    board.appendChild(div);
  });
}

// ------------------------
// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼/AI
// ------------------------
function playerMove(card){
  if(!gameRunning || aiTurn) return;
  openCard(card);
  setTimeout(()=>{ if(gameRunning) aiMove(); },1000);
}

function openCard(card){
  if(card.classList.contains('open')) return;
  card.classList.add('open');
  card.textContent=card.dataset.icon;
  card.style.boxShadow=`0 0 20px ${card.dataset.color}`;
  opened.push(card);
  if(aiDifficulty!=='easy'){ aiMemory[card.dataset.index]=card.dataset.element; }
  if(opened.length===2) setTimeout(checkMatch,800);
}

// ------------------------
// ãƒãƒƒãƒç¢ºèª
// ------------------------
function checkMatch(){
  const [a,b]=opened;
  if(a.dataset.element===b.dataset.element){
    streak++;
    const el=document.getElementById('element').value;
    elementWins[el]=(elementWins[el]||0)+1;
    localStorage.setItem('elementWins',JSON.stringify(elementWins));
    if(streak>maxStreak) maxStreak=streak;
    checkAchievements();
    checkTitleUpgrade(el);
  } else streak=0;
  opened.forEach(c=>{
    if(c.dataset.element!==a.dataset.element){ c.classList.remove('open'); c.textContent=''; c.style.boxShadow=''; }
  });
  opened=[];
  renderStatus();
}

// ------------------------
// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
// ------------------------
function renderStatus(){
  document.getElementById('streak').textContent=streak;
  let totalWins=Object.values(elementWins).reduce((a,b)=>a+b,0);
  let totalGames=maxStreak;
  document.getElementById('winRate').textContent=totalGames?Math.round(totalWins/totalGames*100)+'%':'0%';
}

// ------------------------
// ã‚¹ã‚¿ãƒ¼ãƒˆ/ã‚¹ãƒˆãƒƒãƒ—
// ------------------------
function startGame(){
  if(gameRunning) return;
  gameRunning=true; streak=0; aiTurn=false;
  shuffleCards(); renderStatus();
  alert('ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…ˆæ”»ã§ã™ã€‚');
}
function stopGame(){
  if(!gameRunning) return;
  gameRunning=false; board.innerHTML='';
  alert('ã‚²ãƒ¼ãƒ åœæ­¢ï¼');
}

// ------------------------
// AIå¼·åŒ–
// ------------------------
function changeAIDifficulty(){ aiDifficulty=document.getElementById('aiDifficulty').value; }

function aiMove(){
  if(!gameRunning) return;
  aiTurn=true;
  let cards=Array.from(document.querySelectorAll('.card')).filter(c=>!c.classList.contains('open'));
  if(cards.length<2){ aiTurn=false; return; }
  let pick1,pick2;
  if(aiDifficulty==='easy'){
    pick1=cards[Math.floor(Math.random()*cards.length)];
    pick2=cards[Math.floor(Math.random()*cards.length)];
  } else {
    let found=false;
    for(let i in aiMemory){
      for(let j in aiMemory){
        if(i!==j && aiMemory[i]===aiMemory[j]){
          pick1=document.querySelector(`.card[data-index='${i}']`);
          pick2=document.querySelector(`.card[data-index='${j}']`);
          if(pick1 && pick2){ found=true; break; }
        }
      }
      if(found) break;
    }
    if(!found){
      pick1=cards[Math.floor(Math.random()*cards.length)];
      pick2=cards[Math.floor(Math.random()*cards.length)];
    }
  }
  openCard(pick1); openCard(pick2);
  setTimeout(()=>{ aiTurn=false; },1200);
}

// ------------------------
// ç§°å·ã€å®Ÿç¸¾ã€é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã¯çœç•¥ï¼ˆå‰å›ã‚³ãƒ¼ãƒ‰ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
</script>
</body>
</html>