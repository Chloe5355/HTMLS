<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŸç¥é¢¨å…ƒç´ ç¥çµŒè¡°å¼±</title>
<style>
:root {
  --main: #3ee6c4;
  --bg1: #1b2b4a;
  --bg2: #0b1324;
  --card: #243b6b;
  --card-open: #fff6d0;
}

body {
  font-family: sans-serif;
  background: radial-gradient(circle at top, var(--bg1), var(--bg2));
  color: var(--main);
  text-align: center;
  margin:0; padding:10px;
}

.board {
  display: grid;
  grid-template-columns: repeat(4, 70px);
  gap: 10px;
  justify-content: center;
  margin: 20px 0;
}

.card {
  width: 70px;
  height: 100px;
  background: var(--card);
  border: 2px solid var(--main);
  border-radius: 12px;
  cursor: pointer;
  font-size: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.card.open {
  font-size: 30px;
  background: var(--card-open);
}

#titleFrame {
  padding: 8px 16px;
  border-radius: 12px;
  border: 2px solid var(--main);
  margin: 10px auto;
  display: inline-block;
}

#titleFrame.gold {
  border: 2px solid gold;
  box-shadow: 0 0 15px gold;
  background: linear-gradient(45deg, rgba(255,215,0,0.15), rgba(255,255,255,0.05));
}

#titleFrame.developer {
  border: 3px solid gold;
  background: linear-gradient(135deg, rgba(255,215,0,0.35), rgba(255,255,255,0.1));
  box-shadow: 0 0 20px gold, 0 0 40px rgba(255,215,0,0.6);
  animation: devGlow 3s infinite alternate;
}

@keyframes devGlow {
  from { filter: brightness(1); }
  to   { filter: brightness(1.3); }
}

#achievementList li, #titleList li {
  list-style: none;
  padding: 6px;
  border-left: 3px solid var(--main);
  margin-bottom: 4px;
}
</style>
</head>
<body>
  <h1>åŸç¥é¢¨å…ƒç´ ç¥çµŒè¡°å¼±</h1>

  <!-- ãƒ†ãƒ¼ãƒé¸æŠ -->
  <label for="element">å…ƒç´ ãƒ†ãƒ¼ãƒ:</label>
  <select id="element" onchange="changeElement()">
    <option value="wind">ğŸŒª é¢¨</option>
    <option value="fire">ğŸ”¥ ç‚</option>
    <option value="water">ğŸ’§ æ°´</option>
    <option value="ice">â„ æ°·</option>
    <option value="thunder">âš¡ é›·</option>
    <option value="rock">ğŸª¨ å²©</option>
    <option value="grass">ğŸŒ¿ è‰</option>
  </select>

  <!-- ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ -->
  <div id="board" class="board"></div>

  <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
  <div id="status">
    <p>é€£å‹: <span id="streak">0</span></p>
    <p>å‹ç‡: <span id="winRate">0%</span></p>
  </div>

  <!-- ç§°å·è£…å‚™ -->
  <div id="titleFrame">
    <span id="equippedTitle">ãªã—</span>
  </div>
  <button onclick="equipCurrentTitle()">ğŸ– ã“ã®ç§°å·ã‚’è£…å‚™</button>

  <!-- ç§°å·å›³é‘‘ -->
  <h3>ğŸ“œ ç§°å·å›³é‘‘</h3>
  <ul id="titleList"></ul>

  <!-- å®Ÿç¸¾ä¸€è¦§ -->
  <h3>ğŸ† å®Ÿç¸¾</h3>
  <ul id="achievementList"></ul>

  <!-- é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ãƒ‘ãƒãƒ« -->
  <div id="devPanel" style="display:none">
    <h3>ğŸ¨ Developer Mode</h3>
    <input type="color" id="uiColor" />
    <button onclick="applyUIColor()">é©ç”¨</button>
  </div>

<script>
// ------------------------
// å…ƒç´ å®šç¾©
// ------------------------
const ELEMENTS = [
  { id: 'wind',    name: 'é¢¨', icon: 'ğŸŒª', color: '#3ee6c4' },
  { id: 'fire',    name: 'ç‚', icon: 'ğŸ”¥', color: '#ff4b4b' },
  { id: 'water',   name: 'æ°´', icon: 'ğŸ’§', color: '#3b82f6' },
  { id: 'ice',     name: 'æ°·', icon: 'â„', color: '#7dd3fc' },
  { id: 'thunder', name: 'é›·', icon: 'âš¡', color: '#a855f7' },
  { id: 'rock',    name: 'å²©', icon: 'ğŸª¨', color: '#facc15' },
  { id: 'grass',   name: 'è‰', icon: 'ğŸŒ¿', color: '#22c55e' }
];

// ------------------------
// ã‚²ãƒ¼ãƒ å¤‰æ•°
// ------------------------
let board = document.getElementById('board');
let opened = [];
let elementWins = JSON.parse(localStorage.getItem('elementWins')) || {};
let ownedTitles = JSON.parse(localStorage.getItem('titles')) || {};
let equippedTitle = localStorage.getItem('equippedTitle') || '';
let developerMode = localStorage.getItem('developerMode')==='true';
let maxStreak=0;
let streak=0;

// ------------------------
// ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
// ------------------------
function shuffleCards(){
  board.innerHTML='';
  let cards = [...ELEMENTS,...ELEMENTS].sort(()=>Math.random()-0.5);
  cards.forEach((el,i)=>{
    const div=document.createElement('div');
    div.className='card';
    div.dataset.element=el.id;
    div.dataset.icon=el.icon;
    div.dataset.color=el.color;
    div.dataset.index=i;
    div.onclick=()=>openCard(div);
    board.appendChild(div);
  });
}

function openCard(card){
  if(card.classList.contains('open')) return;
  card.classList.add('open');
  card.textContent=card.dataset.icon;
  card.style.boxShadow=`0 0 20px ${card.dataset.color}`;
  opened.push(card);
  if(opened.length===2) setTimeout(checkMatch,800);
}

function checkMatch(){
  const [a,b]=opened;
  if(a.dataset.element===b.dataset.element){
    alert('ãƒšã‚¢æˆåŠŸï¼');
    const el=document.getElementById('element').value;
    elementWins[el]=(elementWins[el]||0)+1;
    localStorage.setItem('elementWins',JSON.stringify(elementWins));
    streak++; if(streak>maxStreak) maxStreak=streak;
    checkAchievements();
    checkTitleUpgrade(el);
  }else{
    a.classList.remove('open'); a.textContent=''; a.style.boxShadow='';
    b.classList.remove('open'); b.textContent=''; b.style.boxShadow='';
    streak=0;
  }
  opened=[];
  renderStatus();
}

function renderStatus(){
  document.getElementById('streak').textContent=streak;
  let totalWins=Object.values(elementWins).reduce((a,b)=>a+b,0);
  let totalGames=maxStreak;
  document.getElementById('winRate').textContent=totalGames?Math.round(totalWins/totalGames*100)+'%':'0%';
}

// ------------------------
// å…ƒç´ ãƒ†ãƒ¼ãƒ
// ------------------------
function changeElement(){
  const el=document.getElementById('element').value;
  document.body.dataset.element=el;
  localStorage.setItem('element',el);
  updateTitle();
}
const savedElement = localStorage.getItem('element')||'wind';
document.body.dataset.element = savedElement;
document.getElementById('element').value = savedElement;

// ------------------------
// ç§°å·
// ------------------------
const TITLE_LEVELS = {};
ELEMENTS.forEach((el)=>{
  TITLE_LEVELS[el.id]=[
    {win:1,name:el.icon+' '+el.name+'ã®å…±é³´è€…'},
    {win:5,name:el.icon+' '+el.name+'ã®ç†Ÿç·´è€…'},
    {win:10,name:el.icon+' '+el.name+'ã®å¤§å…±é³´è€…'}
  ];
});
const DEVELOPER_TITLE='ğŸ‘¨â€ğŸ’» é–‹ç™ºè€…';

function checkTitleUpgrade(el){
  const wins=elementWins[el]||0;
  TITLE_LEVELS[el].forEach(l=>{
    if(wins===l.win){ ownedTitles[el]=l.name; localStorage.setItem('titles',JSON.stringify(ownedTitles)); alert('ğŸ· ç§°å·æ˜‡æ ¼ï¼\n'+l.name);}
  });
  updateTitle();
}

function updateTitle(){
  const el=document.getElementById('element').value;
  document.getElementById('currentTitle')?.remove();
  const p=document.createElement('p'); p.id='currentTitle';
  p.textContent=ownedTitles[el]||'æœªç²å¾—';
  document.body.appendChild(p);
}

function equipCurrentTitle(){
  const el=document.getElementById('element').value;
  if(!ownedTitles[el]) return alert('ã¾ã ç§°å·ãŒã‚ã‚Šã¾ã›ã‚“');
  equippedTitle=ownedTitles[el];
  localStorage.setItem('equippedTitle',equippedTitle);
  updateEquippedTitleUI();
}

function updateEquippedTitleUI(){
  const frame=document.getElementById('titleFrame');
  const span=document.getElementById('equippedTitle');
  span.textContent=equippedTitle||'ãªã—';
  frame.classList.remove('gold','developer');
  if(equippedTitle===DEVELOPER_TITLE){ frame.classList.add('developer'); enableDeveloperMode(); return; }
  if(ownedTitles[equippedTitle]) frame.classList.add('gold');
}
updateEquippedTitleUI();

// ------------------------
// å®Ÿç¸¾
// ------------------------
let unlockedAchievements = JSON.parse(localStorage.getItem('achievements'))||{};
const ACHIEVEMENTS=[
  {id:'win10',name:'10é€£å‹',condition:()=>maxStreak>=10,reward:{type:'title',value:'ğŸ† é€£å‹ã®è¦‡è€…'}},
  {id:'grassMaster',name:'è‰å…ƒç´ 10å‹',condition:()=> (elementWins.grass||0)>=10,reward:{type:'elementTitle',element:'grass',level:2}},
  {id:'allElements',name:'å…¨å…ƒç´ åˆ¶è¦‡',condition:()=>Object.keys(TITLE_LEVELS).every(el=>elementWins[el]>=1),reward:{type:'specialTitle',value:'ğŸŒˆ ä¸ƒå…ƒç´ ã®å…±é³´è€…'}}
];

function checkAchievements(){
  ACHIEVEMENTS.forEach(a=>{
    if(unlockedAchievements[a.id]) return;
    if(a.condition()){
      unlockedAchievements[a.id]=true;
      localStorage.setItem('achievements',JSON.stringify(unlockedAchievements));
      grantAchievementReward(a);
    }
  });
  renderAchievementList();
  renderTitleList();
}

function grantAchievementReward(a){
  let msg=`ğŸ† å®Ÿç¸¾è§£é™¤ï¼\n${a.name}\n\n`;
  if(a.reward.type==='title'){ ownedTitles.special=a.reward.value; msg+=`ç§°å·ç²å¾—ï¼š${a.reward.value}`;}
  if(a.reward.type==='elementTitle'){ const el=a.reward.element; const lvl=a.reward.level; ownedTitles[el]=TITLE_LEVELS[el][lvl].name; msg+=`ç§°å·é€²åŒ–ï¼š${ownedTitles[el]}`;}
  if(a.reward.type==='specialTitle'){ ownedTitles.special[a.reward.value]=true; equippedTitle=a.reward.value; msg+=`ç‰¹åˆ¥ç§°å·ï¼š${a.reward.value}`;}
  localStorage.setItem('titles',JSON.stringify(ownedTitles));
  alert(msg);
}

function renderAchievementList(){
  const ul=document.getElementById('achievementList'); if(!ul) return;
  ul.innerHTML='';
  ACHIEVEMENTS.forEach(a=>{
    const li=document.createElement('li');
    const done=unlockedAchievements[a.id];
    li.textContent=done?`âœ” ${a.name}`:`â“ ${a.name}`;
    li.style.opacity=done?1:0.4;
    ul.appendChild(li);
  });
}

// ------------------------
// ç§°å·å›³é‘‘
// ------------------------
function renderTitleList(){
  const ul=document.getElementById('titleList'); if(!ul) return;
  ul.innerHTML='';
  for(let el in TITLE_LEVELS){
    TITLE_LEVELS[el].forEach(l=>{
      const li=document.createElement('li');
      const owned=Object.values(ownedTitles).includes(l.name);
      li.textContent=owned?l.name:'â“ æœªè§£æ”¾';
      li.style.opacity=owned?1:0.4;
      ul.appendChild(li);
    });
  }
}
renderTitleList();

// ------------------------
// é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰
// ------------------------
function enableDeveloperMode(){
  developerMode=true;
  localStorage.setItem('developerMode','true');
  document.getElementById('devPanel').style.display='block';
}

function applyUIColor(){
  const color=document.getElementById('uiColor').value;
  document.documentElement.style.setProperty('--main',color);
  localStorage.setItem('devColor',color);
}

const savedColor=localStorage.getItem('devColor');
if(savedColor && developerMode){
  document.documentElement.style.setProperty('--main',savedColor);
  document.getElementById('devPanel').style.display='block';
}

// ------------------------
// åˆæœŸåŒ–
// ------------------------
shuffleCards();
renderStatus();
</script>
</body>
</html>
