<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŸç¥é¢¨å…ƒç´ ç¥çµŒè¡°å¼± å®Œå…¨ç‰ˆ</title>
<style>
:root {
  --main: #3ee6c4;
  --bg1: #1b2b4a;
  --bg2: #0b1324;
  --card: #243b6b;
  --card-open: #fff6d0;
}
body {
  font-family: sans-serif;
  background: radial-gradient(circle at top, var(--bg1), var(--bg2));
  color: var(--main);
  text-align: center;
  margin:0; padding:10px;
}
.screen { display:none; }
.screen.active { display:block; }
.board {
  display: grid;
  grid-template-columns: repeat(4, 70px);
  gap: 10px;
  justify-content: center;
  margin: 20px 0;
}
.card {
  width: 70px;
  height: 100px;
  perspective: 600px;
}
.card-inner {
  width: 100%;
  height: 100%;
  border-radius: 12px;
  transition: transform 0.6s;
  transform-style: preserve-3d;
  position: relative;
}
.card.open .card-inner { transform: rotateY(180deg); }
.card-front, .card-back {
  position: absolute;
  width: 100%; height: 100%;
  backface-visibility: hidden;
  border: 2px solid var(--main);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 30px;
}
.card-front { background: var(--card); }
.card-back {
  background: var(--card-open);
  transform: rotateY(180deg);
  box-shadow: 0 0 20px var(--main);
  animation: glow 1.2s ease-in-out infinite alternate;
}
@keyframes glow { 0% {box-shadow:0 0 10px var(--main);} 100% {box-shadow:0 0 30px var(--main);} }

#titleFrame { padding:8px 16px; border-radius:12px; border:2px solid var(--main); margin:10px auto; display:inline-block; }
#titleFrame.gold { border-color: gold; box-shadow: 0 0 15px gold; }
#titleFrame.developer {
  border:3px solid gold;
  background: linear-gradient(135deg, rgba(255,215,0,0.35), rgba(255,255,255,0.1));
  box-shadow:0 0 20px gold,0 0 40px rgba(255,215,0,0.6);
  animation: devGlow 3s infinite alternate;
}
@keyframes devGlow { from {filter:brightness(1);} to {filter:brightness(1.3);} }

button { margin:5px; padding:6px 12px; border-radius:6px; cursor:pointer; }
ul { padding-left:0; }
li { list-style:none; padding:4px 0; border-left:3px solid var(--main); margin-bottom:4px; }

#winScreen {
  position: fixed; top:0; left:0; width:100%; height:100%;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  color:#fff; font-size:2em; text-shadow:0 0 10px #000;
  z-index:100; animation: winGlow 2s infinite alternate;
}
@keyframes winGlow { 0% { filter: brightness(1); } 50% { filter: brightness(1.3); } 100% { filter: brightness(1); } }

#codeToggleContainer { position:fixed; bottom:0; width:100%; text-align:center; padding:5px; background:rgba(0,0,0,0.5); }
#codePanel { display:none; position:fixed; bottom:40px; left:0; width:100%; max-height:50%; overflow:auto; background:#111; color:#fff; font-family:monospace; font-size:12px; padding:10px; z-index:200; }
</style>
</head>
<body>

<!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
<div id="titleScreen" class="screen active">
  <h1>åŸç¥é¢¨å…ƒç´ ç¥çµŒè¡°å¼±</h1>
  <label for="element">å…ƒç´ ãƒ†ãƒ¼ãƒ:</label>
  <select id="element" onchange="changeElement()">
    <option value="wind">ğŸŒª é¢¨</option>
    <option value="fire">ğŸ”¥ ç‚</option>
    <option value="water">ğŸ’§ æ°´</option>
    <option value="ice">â„ æ°·</option>
    <option value="thunder">âš¡ é›·</option>
    <option value="rock">ğŸª¨ å²©</option>
    <option value="grass">ğŸŒ¿ è‰</option>
  </select>
  <br>
  <label for="aiDifficulty">AIé›£æ˜“åº¦:</label>
  <select id="aiDifficulty">
    <option value="easy">å¼±</option>
    <option value="medium">ä¸­</option>
    <option value="hard">å¼·</option>
  </select>
  <br>
  <button onclick="startGame()">â–¶ ã‚²ãƒ¼ãƒ é–‹å§‹</button>
</div>

<!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
<div id="gameScreen" class="screen">
  <div>
    <button onclick="stopGame()">â¹ ã‚²ãƒ¼ãƒ çµ‚äº†</button>
  </div>
  <div id="board" class="board"></div>
  <div id="status">
    <p>é€£å‹: <span id="streak">0</span></p>
    <p>å‹ç‡: <span id="winRate">0%</span></p>
  </div>
  <div id="titleFrame"><span id="equippedTitle">ç§°å·ãªã—</span></div>
  <button onclick="equipCurrentTitle()">ğŸ– ç§°å·ã‚’è£…å‚™</button>
  <h3>ğŸ“œ ç§°å·ä¸€è¦§</h3>
  <ul id="titleList"></ul>
  <h3>ğŸ† å®Ÿç¸¾</h3>
  <ul id="achievementList"></ul>
  <div id="devPanel" style="display:none">
    <h3>ğŸ¨ Developer Mode</h3>
    <input type="color" id="uiColor"/>
    <button onclick="applyUIColor()">é©ç”¨</button>
  </div>
</div>

<!-- å‹åˆ©ç”»é¢ -->
<div id="winScreen" class="screen">
  <h1>ğŸ† å‹åˆ©ï¼</h1>
  <p>é€£å‹: <span id="winStreak">0</span></p>
  <p>ç²å¾—ç§°å·: <span id="winTitle">ãªã—</span></p>
  <button onclick="nextGame()">æ¬¡ã®ã‚²ãƒ¼ãƒ </button>
  <button onclick="stopGame()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
</div>

<!-- ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºãƒœã‚¿ãƒ³ -->
<div id="codeToggleContainer">
  <button id="codeToggleBtn">ğŸ“œ ã‚³ãƒ¼ãƒ‰è¡¨ç¤º</button>
</div>

<!-- ã‚³ãƒ¼ãƒ‰ãƒ‘ãƒãƒ« -->
<div id="codePanel">
  <details>
    <summary>index.html</summary>
    <pre id="codeIndex"></pre>
  </details>
  <details>
    <summary>css/style.css</summary>
    <pre id="codeCSS"></pre>
  </details>
  <details>
    <summary>js/game.js</summary>
    <pre id="codeJS"></pre>
  </details>
</div>

<script>
const ELEMENTS = [
  { id:'wind', icon:'ğŸŒª', color:'#3ee6c4', name:'é¢¨' },
  { id:'fire', icon:'ğŸ”¥', color:'#ff4b4b', name:'ç‚' },
  { id:'water', icon:'ğŸ’§', color:'#3b82f6', name:'æ°´' },
  { id:'ice', icon:'â„', color:'#7dd3fc', name:'æ°·' },
  { id:'thunder', icon:'âš¡', color:'#a855f7', name:'é›·' },
  { id:'rock', icon:'ğŸª¨', color:'#facc15', name:'å²©' },
  { id:'grass', icon:'ğŸŒ¿', color:'#22c55e', name:'è‰' }
];

let board=document.getElementById('board');
let opened=[], gameRunning=false, aiTurn=false;
let aiDifficulty='medium', aiMemory={};
let streak=0, maxStreak=0;
let ownedTitles={}, equippedTitle='', developerMode=false;

const ACHIEVEMENTS = [
  { name:'10é€£å‹', condition:10, type:'win', title:'å¤§å…±é³´è€…', special:false },
  { name:'å…¨å‹', condition:100, type:'win', title:'é–‹ç™ºè€…ç§°å·', special:true }
];

function changeElement(){
  if(gameRunning) return;
  const elId=document.getElementById('element').value;
  const element=ELEMENTS.find(e=>e.id===elId);
  if(element) document.documentElement.style.setProperty('--main', element.color);
}

function startGame(){
  document.getElementById('titleScreen').classList.remove('active');
  document.getElementById('gameScreen').classList.add('active');
  gameRunning=true; aiTurn=false; streak=0; maxStreak=0;
  aiDifficulty=document.getElementById('aiDifficulty').value;
  changeElement();
  shuffleCards(); renderStatus();
  document.getElementById('element').disabled=true;
}

function stopGame(){
  document.getElementById('titleScreen').classList.add('active');
  document.getElementById('gameScreen').classList.remove('active');
  document.getElementById('winScreen').classList.remove('active');
  gameRunning=false; aiTurn=false; board.innerHTML='';
  document.getElementById('element').disabled=false;
}

function shuffleCards(){
  board.innerHTML=''; opened=[]; aiMemory={};
  let cards=[...ELEMENTS,...ELEMENTS].sort(()=>Math.random()-0.5);
  cards.forEach((el,i)=>{
    const div=document.createElement('div');
    div.className='card';
    div.dataset.element=el.id;
    div.dataset.icon=el.icon;
    div.dataset.color=el.color;
    div.dataset.index=i;
    div.innerHTML = `<div class="card-inner"><div class="card-front"></div><div class="card-back">${el.icon}</div></div>`;
    div.onclick=()=>playerMove(div);
    board.appendChild(div);
  });
}

function playerMove(card){
  if(!gameRunning || aiTurn || card.classList.contains('open')) return;
  openCard(card);
  if(opened.length===2){ aiTurn=true; setTimeout(checkMatch,800); }
}
function openCard(card){ card.classList.add('open'); opened.push(card); if(aiDifficulty!=='easy') aiMemory[card.dataset.index]=card.dataset.element; }
function closeCard(card){ card.classList.remove('open'); opened = opened.filter(c => c!==card); }

function checkMatch(){
  const [a,b]=opened;
  if(a.dataset.element!==b.dataset.element){
    setTimeout(()=>{ closeCard(a); closeCard(b); setTimeout(aiMove,500); },500);
  } else {
    streak++; maxStreak=Math.max(streak,maxStreak); opened=[];
    checkAchievements();
    const allOpen = Array.from(document.querySelectorAll('.card')).every(c=>c.classList.contains('open'));
    if(allOpen) showWinScreen();
    else setTimeout(aiMove,500);
  }
  renderStatus();
}

function aiMove(){
  if(!gameRunning){ aiTurn=false; return; }
  let cards=Array.from(document.querySelectorAll('.card')).filter(c=>!c.classList.contains('open'));
  if(cards.length<2){ aiTurn=false; return; }

  aiTurn=true;
  let pick1,pick2;
  if(aiDifficulty==='easy'){
    pick1=cards[Math.floor(Math.random()*cards.length)];
    pick2=cards[Math.floor(Math.random()*cards.length)];
  } else {
    let found=false;
    for(let i in aiMemory){ for(let j in aiMemory){ if(i!==j && aiMemory[i]===aiMemory[j]){
      pick1=document.querySelector(`.card[data-index='${i}']`);
      pick2=document.querySelector(`.card[data-index='${j}']`);
      if(pick1 && pick2){ found=true; break; } } } if(found) break; }
    if(!found){ pick1=cards[Math.floor(Math.random()*cards.length)]; pick2=cards[Math.floor(Math.random()*cards.length)]; }
  }

  openCard(pick1);
  setTimeout(()=>{ openCard(pick2); setTimeout(()=>{ checkMatch(); aiTurn=false; },800); },500);
}

function renderStatus(){
  document.getElementById('streak').textContent=streak;
  let winRate=maxStreak?Math.round(streak/maxStreak*100):0;
  document.getElementById('winRate').textContent=winRate+'%';
}

function checkAchievements(){
  ACHIEVEMENTS.forEach(a=>{
    if(!ownedTitles[a.title] && streak>=a.condition){
      ownedTitles[a.title]=true;
      const li=document.createElement('li'); li.textContent=a.title + (a.special?' ğŸ”¥':'');
      if(a.special) li.style.color='gold';
      document.getElementById('titleList').appendChild(li);
      if(a.title==='é–‹ç™ºè€…ç§°å·'){ equipTitle('é–‹ç™ºè€…ç§°å·'); developerMode=true; document.getElementById('devPanel').style.display='block'; }
    }
  });
}

function equipCurrentTitle(){ const titles=Object.keys(ownedTitles); if(titles.length>0) equipTitle(titles[titles.length-1]); }
function equipTitle(title){
  equippedTitle=title;
  const frame=document.getElementById('titleFrame');
  const span=document.getElementById('equippedTitle');
  span.textContent=title;
  frame.className='';
  if(title==='é–‹ç™ºè€…ç§°å·') frame.classList.add('developer');
  else if(title.includes('å¤§å…±é³´è€…')) frame.classList.add('gold');
}

function showWinScreen(){
  gameRunning=false; aiTurn=false;
  document.getElementById('gameScreen').classList.remove('active');
  const winScreen=document.getElementById('winScreen'); winScreen.classList.add('active');
  document.getElementById('winStreak').textContent=streak;
  const titles=Object.keys(ownedTitles);
  document.getElementById('winTitle').textContent = titles.length>0 ? titles[titles.length-1] : 'ãªã—';
  const elId=document.getElementById('element').value;
  const element=ELEMENTS.find(e=>e.id===elId);
  if(element) winScreen.style.background = `radial-gradient(circle, ${element.color} 0%, transparent 70%)`;
}

function nextGame(){ document.getElementById('winScreen').classList.remove('active'); document.getElementById('gameScreen').classList.add('active'); gameRunning=true; aiTurn=false; shuffleCards(); renderStatus(); }
function applyUIColor(){ if(!developerMode) return; const color=document.getElementById('uiColor').value; document.documentElement.style.setProperty('--main', color); }

// ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºãƒ‘ãƒãƒ«
const codeToggleBtn = document.getElementById('codeToggleBtn');
const codePanel = document.getElementById('codePanel');
codeToggleBtn.onclick = () => { codePanel.style.display = codePanel.style.display==='none'?'block':'none'; };
document.getElementById('codeIndex').textContent = document.documentElement.outerHTML;
document.getElementById('codeCSS').textContent = document.querySelector('style').textContent;
document.getElementById('codeJS').textContent = "// å…¨JSã‚³ãƒ¼ãƒ‰ã¯ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆéƒ¨åˆ†ã«å«ã¾ã‚Œã¾ã™";
</script>
</body>
</html>
